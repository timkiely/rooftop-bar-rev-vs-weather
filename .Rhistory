models
?data.grid
library(modelr)
?data_grid
data_grid(mtcars, mpg = seq_range(mpg, 10))
mod <- lm(mpg ~ wt + cyl + vs, data = mtcars)
data_grid(mtcars, .model = mod)
data_grid(rev_ts_model, .model = f4)
rev_ts_model
f4
data_grid(rev_ts_model, .model = f4)
data_grid(rev_ts_model, .model = f3)
data_grid(rev_ts_model, .model = f3_lm)
f3_lm
data_grid(rev_ts_model, .model = f3_lm)
sim1
sim1 %>%
data_grid(x)
grid <-
sim1 %>%
data_grid(x)
grid
sim1_mod <- lm(y ~ x, data = sim1)
sim1_mod
grid %>% add_predictions(sim1_mod)
rev_ts_model
rev_ts_model %>%
data_grid()
rev_ts_model %>%
data_grid(Mean_TemperatureF)
grid <-
rev_ts_model %>%
data_grid(Mean_TemperatureF)
sim1_mod <- lm(Earnings~Mean_TemperatureF, data = rev_ts_model)
grid %>% add_predictions(sim1_mod)
grid <- grid %>% add_predictions(sim1_mod)
ggplot(rev_ts_model, aes(Earnings)) +
geom_point(aes(y = Mean_TemperatureF)) +
geom_line(aes(y = pred), data = grid, colour = "red", size = 1)
rev_ts_model
ggplot(rev_ts_model, aes(x=Earnings)) +
geom_point(aes(y = Mean_TemperatureF)) +
geom_line(aes(y = pred), data = grid, colour = "red", size = 1)
rev_ts_model
rev_ts_model %>%
ggplot() +
aes(x=Earnings) +
geom_point(aes(y = Mean_TemperatureF)) +
geom_line(aes(y = pred), data = grid, colour = "red", size = 1)
Earnings
rev_ts_model
?aes
rev_ts_model %>%
ggplot() +
aes(x=Earnings)
rev_ts_model %>%
ggplot() +
aes(x=Earnings) +
geom_point(aes(y = Mean_TemperatureF))
rev_ts_model %>%
ggplot() +
aes(x=Earnings) +
geom_point(aes(y = Mean_TemperatureF)) +
geom_line(aes(y = pred), data = grid, colour = "red", size = 1)
rev_ts_model %>%
ggplot() +
aes(x=Earnings) +
geom_point(aes(y = Mean_TemperatureF))
grid
rev_ts_model %>%
ggplot() +
aes(x=Mean_TemperatureF) +
geom_point(aes(y = Earnings)) +
geom_line(aes(y = pred), data = grid, colour = "red", size = 1)
rev_ts_model %>%
add_prediction(sim1_mod) %>%
add_residuals(sim1_mod)
rev_ts_model %>%
add_predictions(sim1_mod) %>%
add_residuals(sim1_mod)
rev_ts_model %>%
add_predictions(sim1_mod) %>%
add_residuals(sim1_mod) %>%
ggplot(aes(resid)) +
geom_freqpoly(binwidth = 0.5)
rev_ts_model %>%
add_predictions(sim1_mod) %>%
add_residuals(sim1_mod) %>%
ggplot(aes(Mean_TemperatureF, resid)) +
geom_ref_line(h = 0) +
geom_point()
sim1_mod <- loess(Earnings~Mean_TemperatureF, data = rev_ts_model)
grid <- grid %>% add_predictions(sim1_mod)
rev_ts_model %>%
ggplot() +
aes(x=Mean_TemperatureF) +
geom_point(aes(y = Earnings)) +
geom_line(aes(y = pred), data = grid, colour = "red", size = 1)
rev_ts_model %>%
add_predictions(sim1_mod) %>%
add_residuals(sim1_mod) %>%
ggplot(aes(resid)) +
geom_freqpoly(binwidth = 0.5)
rev_ts_model %>%
add_predictions(sim1_mod) %>%
add_residuals(sim1_mod) %>%
ggplot(aes(Mean_TemperatureF, resid)) +
geom_ref_line(h = 0) +
geom_point()
?gather_predictions
df <- tibble::data_frame(
x = sort(runif(100)),
y = 5 * x + 0.5 * x ^ 2 + 3 + rnorm(length(x))
)
df
plot(df)
5 * x + 0.5 * x ^ 2 + 3 + rnorm(length(x))
m1 <- lm(y ~ x, data = df)
grid <- data.frame(x = seq(0, 1, length = 10))
grid %>% add_predictions(m1)
m2 <- lm(y ~ poly(x, 2), data = df)
grid %>% spread_predictions(m1, m2)
grid %>% gather_predictions(m1, m2)
df <- tribble(
~y, ~x1, ~x2,
4, 2, 5,
5, 1, 6
)
df
?tribble
df <- tribble(
~y, ~x1, ~x2,
4,   2,   5,
5,   1,   6
)
df
model_matrix(df, y ~ x1)
model_matrix(df, y ~ x1 + x2 + x3)
model_matrix(df, y ~ x1 + x2 )
rev_ts_model %>%
add_predictions(sim1_mod) %>%
add_residuals(sim1_mod) %>%
ggplot(aes(Mean_TemperatureF, resid)) +
geom_ref_line(h = 0) +
geom_point()
mod1 <- lm(Earnings ~ ns(Mean_TemperatureF, 5), data = rev_ts_model)
?ns
library(stats)
?ns
library(splines)
mod1 <- lm(Earnings ~ ns(Mean_TemperatureF, 5), data = rev_ts_model)
mod1
plot(mod1)
summary(mod1)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,5)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,3)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
#Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
#Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
Mean_TemperatureF+
#poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
#Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
#Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,3)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
#Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,4)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
#Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
#Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
#Events+
WindDirDegrees+
#Special+
#Happy_Hour+
#Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
I(Mean_TemperatureF^2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
#poly(Mean_TemperatureF,2)+
I(Mean_TemperatureF^2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model)
summary(f1_lm)
rev_ts_model %>% filter(Special_ind==TRUE) %>% norw
rev_ts_model %>% filter(Special_ind==TRUE) %>% nrow
rev_ts_model
rev_ts_model_ex_spec <-
rev_ts %>% mutate(Happy_Hour = grepl("Happy Hour",Special)
,Special_ind = ifelse(is.na(Special),FALSE,TRUE)
,Rain_ind = grepl("Rain",Events)
,Events = factor(Events)) %>%
filter(Earnings>0) %>%
filter(!is.na(Earnings)) %>%
filter(Special_ind==FALSE)
f1 <- as.formula(
Earnings~
Mean_TemperatureF+
#poly(Mean_TemperatureF,2)+
#I(Mean_TemperatureF^2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
Events+
WindDirDegrees+
Special+
Happy_Hour+
Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model_ex_spec)
summary(f1_lm)
f1 <- as.formula(
Earnings~
Mean_TemperatureF+
#poly(Mean_TemperatureF,2)+
#I(Mean_TemperatureF^2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
#Events+
WindDirDegrees
#Special+
#Happy_Hour+
#Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model_ex_spec)
summary(f1_lm)
f1 <- as.formula(
Earnings~
#Mean_TemperatureF+
poly(Mean_TemperatureF,2)+
#I(Mean_TemperatureF^2)+
MeanDew_PointF+
Mean_Humidity+
Mean_Sea_Level_PressureIn+
Mean_VisibilityMiles+
Mean_Wind_SpeedMPH+
Max_Gust_SpeedMPH+
PrecipitationIn+
CloudCover+
#Events+
WindDirDegrees
#Special+
#Happy_Hour+
#Special_ind
)
f1_lm <- lm(formula = f1, data = rev_ts_model_ex_spec)
summary(f1_lm)
setwd("~/Dropbox (hodgeswardelliott)/hodgeswardelliott Team Folder/Teams/Data/Tim_Kiely/Weather vs Revenue")
dir()
